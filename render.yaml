services:
  # -----------------------------
  # Backend Service (FastAPI)
  # -----------------------------
  - type: web
    name: supoclip-backend
    env: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile
    plan: free
    region: oregon
    numInstances: 1
    healthCheckPath: /health/db
    envVarGroups:
      - supoclip-secrets
    envVars:
      - key: PYTHONUNBUFFERED
        value: 1
      
      # ---- APP SETTINGS ----
      - key: LLM
        value: openai:gpt-4
      - key: WHISPER_MODEL_SIZE
        value: medium
      - key: TEMP_DIR
        value: /tmp/uploads


  # -----------------------------
  # Frontend Service (Next.js)
  # -----------------------------
  - type: web
    name: supoclip-frontend
    env: docker
    dockerContext: ./frontend
    dockerfilePath: ./frontend/Dockerfile
    plan: free
    region: oregon
    numInstances: 1
    envVarGroups:
      - supoclip-secrets
    envVars:
      - key: NODE_ENV
        value: production

      # Backend URL for API calls
      - key: NEXT_PUBLIC_API_URL
        fromService:
          type: web
          name: supoclip-backend
          property: url

      # Auth config
      - key: BETTER_AUTH_URL
        fromService:
          type: web
          name: supoclip-frontend
          property: url
      - key: BETTER_AUTH_SECRET
        generateValue: true


  # -----------------------------
  # Worker Service (ARQ Worker)
  # -----------------------------
  - type: worker
    name: supoclip-worker
    env: docker
    dockerContext: .
    dockerfilePath: ./Dockerfile
    dockerCommand: "arq src.workers.tasks.WorkerSettings"
    plan: free
    region: oregon
    numInstances: 1
    envVarGroups:
      - supoclip-secrets
    envVars:
      - key: PYTHONUNBUFFERED
        value: 1

      - key: WHISPER_MODEL_SIZE
        value: base
      - key: TEMP_DIR
        value: /tmp/uploads


# ---------------------------------------------------
# ðŸš¨ Removed:
# - Built-in Render PostgreSQL
# - Render Redis
# Because you're using Supabase + Railway instead
# ---------------------------------------------------
